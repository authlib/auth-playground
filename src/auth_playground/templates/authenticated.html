<div class="buttons-right">
    {% if token.refresh_token %}
        <form method="POST" action="{{ url_for('routes.refresh') }}">
            {{ refresh_form.hidden_tag() }}
            {{ refresh_form.submit() }}
        </form>
    {% endif %}
    <div role="group">
        <a href="{{ url_for('routes.login') }}" role="button">Sign in again</a>
        <a href="{{ url_for('routes.consent') }}" role="button">Consent again</a>
        <a href="{{ url_for('routes.logout') }}" role="button" class="contrast">Log out</a>
    </div>
</div>

<section>
    <h2>Token Information</h2>
    <p>Here are the tokens received from the identity provider:</p>

    {% if token.id_token and user %}
        <article>
            <h3>ID Token & User Information</h3>
            <p><small>Contains user identity information in JWT format.</small></p>
            <div role="group">
                <input type="text" value="{{ token.id_token }}" readonly aria-label="ID Token">
                <button type="button" class="copy-token-btn secondary">Copy</button>
            </div>

            <div class="grid">
                <div>
                    <h4>User Claims</h4>

                    {% if user.picture %}
                        <img src="{{ user.picture }}" alt="User avatar" class="user-avatar">
                    {% endif %}

                    <ul>
                        {% if user.sub %}
                            <li><strong data-tooltip="sub">User name:</strong> <code>{{ user.sub }}</code></li>
                        {% endif %}

                        {% if user.preferred_username %}
                            <li><strong data-tooltip="preferred_username">Display name:</strong> {{ user.preferred_username }}</li>
                        {% endif %}

                        {% if user.name %}
                            <li><strong data-tooltip="name">Full name:</strong> {{ user.name }}</li>
                        {% endif %}

                        {% if user.given_name %}
                            <li><strong data-tooltip="given_name">Given Name:</strong> {{ user.given_name }}</li>
                        {% endif %}

                        {% if user.family_name %}
                            <li><strong data-tooltip="family_name">Family Name:</strong> {{ user.family_name }}</li>
                        {% endif %}

                        {% if user.email %}
                            <li><strong data-tooltip="email">Email:</strong> <a href="mailto:{{ user.email }}">{{ user.email }}</a></li>
                        {% endif %}

                        {% if user.email_verified is defined %}
                            <li><strong data-tooltip="email_verified">Email Verified:</strong> {{ user.email_verified }}</li>
                        {% endif %}

                        {% if user.phone_number %}
                            <li><strong data-tooltip="phone_number">Phone:</strong> <a href="tel:{{ user.phone_number }}">{{ user.phone_number }}</a></li>
                        {% endif %}

                        {% if user.address %}
                            <li>
                                <strong data-tooltip="address">Address:</strong>
                                <ul>
                                    {% if user.address.get("formatted") %}
                                        <li>{{ user.address["formatted"] }}</li>
                                    {% else %}
                                        {% if user.address.get("street_address") %}
                                            <li>{{ user.address["street_address"] }}</li>
                                        {% endif %}
                                        {% if user.address.get("postal_code") %}
                                            <li>{{ user.address["postal_code"] }}</li>
                                        {% endif %}
                                        {% if user.address.get("locality") %}
                                            <li>{{ user.address["locality"] }}</li>
                                        {% endif %}
                                        {% if user.address.get("region") %}
                                            <li>{{ user.address["region"] }}</li>
                                        {% endif %}
                                    {% endif %}
                                </ul>
                            </li>
                        {% endif %}

                        {% if user.locale %}
                            <li><strong data-tooltip="locale">Locale:</strong> {{ user.locale }}</li>
                        {% endif %}

                        {% if user.zoneinfo %}
                            <li><strong data-tooltip="zoneinfo">Timezone:</strong> {{ user.zoneinfo }}</li>
                        {% endif %}

                        {% if user.birthdate %}
                            <li><strong data-tooltip="birthdate">Birthdate:</strong> {{ user.birthdate }}</li>
                        {% endif %}

                        {% if user.gender %}
                            <li><strong data-tooltip="gender">Gender:</strong> {{ user.gender }}</li>
                        {% endif %}

                        {% if user.website %}
                            <li><strong data-tooltip="website">Website:</strong> <a href="{{ user.website }}" target="_blank">{{ user.website }}</a></li>
                        {% endif %}

                        {% if user.groups %}
                            <li>
                                <strong data-tooltip="groups">Groups:</strong>
                                {% for group in user.groups %}
                                    <kbd>{{ group }}</kbd>{% if not loop.last %}, {% endif %}
                                {% endfor %}
                            </li>
                        {% endif %}
                    </ul>
                </div>

                <div>
                    <h4>Token Metadata</h4>

                    <ul>
                        {% if user.iss %}
                            <li><strong data-tooltip="iss">Issuer:</strong> <code>{{ user.iss }}</code></li>
                        {% endif %}

                        {% if user.aud %}
                            <li>
                                <strong data-tooltip="aud">Audience:</strong>
                                {% if user.aud is string %}
                                    <code>{{ user.aud }}</code>
                                {% else %}
                                    {% for aud_item in user.aud %}
                                        <code>{{ aud_item }}</code>{% if not loop.last %}, {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </li>
                        {% endif %}

                        {% if user.auth_time %}
                            <li><strong data-tooltip="auth_time">Auth Time:</strong> {{ user.auth_time|datetimeformat }}</li>
                        {% endif %}

                        {% if user.iat %}
                            <li><strong data-tooltip="iat">Issued At:</strong> {{ user.iat|datetimeformat }}</li>
                        {% endif %}

                        {% if user.exp %}
                            <li><strong data-tooltip="exp">Expires At:</strong> {{ user.exp|datetimeformat }}</li>
                        {% endif %}

                        {% if user.nonce %}
                            <li><strong data-tooltip="nonce">Nonce:</strong> <code>{{ user.nonce }}</code></li>
                        {% endif %}

                        {% if user.at_hash %}
                            <li><strong data-tooltip="at_hash">Access Token Hash:</strong> <code>{{ user.at_hash }}</code></li>
                        {% endif %}

                        {% if user.c_hash %}
                            <li><strong data-tooltip="c_hash">Code Hash:</strong> <code>{{ user.c_hash }}</code></li>
                        {% endif %}

                        {% if user.acr %}
                            <li><strong data-tooltip="acr">Auth Context Class:</strong> <code>{{ user.acr }}</code></li>
                        {% endif %}

                        {% if user.amr %}
                            <li>
                                <strong data-tooltip="amr">Auth Methods:</strong>
                                {% for method in user.amr %}
                                    <code>{{ method }}</code>{% if not loop.last %}, {% endif %}
                                {% endfor %}
                            </li>
                        {% endif %}

                        {% if user.azp %}
                            <li><strong data-tooltip="azp">Authorized Party:</strong> <code>{{ user.azp }}</code></li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </article>
    {% endif %}

    <div class="grid">
        {% if token.access_token %}
            <article>
                <h3>Access Token</h3>
                <p><small>Used to access protected resources on behalf of the user.</small></p>
                <div role="group">
                    <input type="text" value="{{ token.access_token }}" readonly aria-label="Access Token">
                    <button type="button" class="copy-token-btn secondary">Copy</button>
                </div>
                <ul>
                    {% if token.token_type %}
                        <li><strong>Token Type:</strong> {{ token.token_type }}</li>
                    {% endif %}
                    {% if token.expires_in %}
                        <li><strong>Expires In:</strong> {{ token.expires_in }} seconds</li>
                    {% endif %}
                    {% if token.expires_at %}
                        <li><strong>Expires At:</strong> {{ token.expires_at|datetimeformat }}</li>
                    {% endif %}
                    {% if token.scope %}
                        <li><strong>Scope:</strong> {{ token.scope }}</li>
                    {% endif %}
                </ul>
            </article>
        {% endif %}

        {% if token.refresh_token %}
            <article>
                <h3>Refresh Token</h3>
                <p><small>Used to obtain new access tokens without re-authentication.</small></p>
                <div role="group">
                    <input type="text" value="{{ token.refresh_token }}" readonly aria-label="Refresh Token">
                    <button type="button" class="copy-token-btn secondary">Copy</button>
                </div>
            </article>
        {% endif %}
    </div>
</section>
