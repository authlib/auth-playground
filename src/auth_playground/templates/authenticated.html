<div class="buttons-right">
    {% if session.token.refresh_token %}
        <form method="POST" action="{{ url_for('routes.refresh') }}">
            {{ refresh_form.hidden_tag() }}
            {{ refresh_form.submit() }}
        </form>
    {% endif %}
    <div role="group">
        <a href="{{ url_for('routes.login') }}" role="button">Sign in again</a>
        <a href="{{ url_for('routes.consent') }}" role="button">Consent again</a>
        <a href="{{ url_for('routes.logout_local') }}" role="button" class="secondary">Log out</a>
        {% if g.server_config and g.server_config.specs and g.server_config.specs.oidc_rpinitiated_logout %}
            <a href="{{ url_for('routes.logout') }}" role="button" class="contrast">Server log out</a>
        {% endif %}
    </div>
</div>

<section>
    <h2>Token information</h2>
    <p>Here are the tokens received from the {{ g.server_config.display_name }}:</p>

    {% if session.token.id_token and session.user %}
        <article>
            <h3>ID token & user information</h3>
            <p><small>Contains user identity information in JWT format.</small></p>
            <div role="group">
                <input type="text" value="{{ session.token.id_token }}" readonly aria-label="ID Token">
                <button type="button" class="copy-token-btn secondary">Copy</button>
            </div>

            <div class="grid">
                <div>
                    <h4>User claims</h4>

                    {% if session.user.picture %}
                        <img src="{{ session.user.picture }}" alt="User avatar" class="user-avatar">
                    {% endif %}

                    <ul>
                        {% if session.user.sub %}
                            <li><strong data-tooltip="sub">User name:</strong> <code>{{ session.user.sub }}</code></li>
                        {% endif %}

                        {% if session.user.preferred_username %}
                            <li><strong data-tooltip="preferred_username">Display name:</strong> {{ session.user.preferred_username }}</li>
                        {% endif %}

                        {% if session.user.name %}
                            <li><strong data-tooltip="name">Full name:</strong> {{ session.user.name }}</li>
                        {% endif %}

                        {% if session.user.given_name %}
                            <li><strong data-tooltip="given_name">Given name:</strong> {{ session.user.given_name }}</li>
                        {% endif %}

                        {% if session.user.family_name %}
                            <li><strong data-tooltip="family_name">Family name:</strong> {{ session.user.family_name }}</li>
                        {% endif %}

                        {% if session.user.email %}
                            <li><strong data-tooltip="email">Email:</strong> <a href="mailto:{{ session.user.email }}">{{ session.user.email }}</a></li>
                        {% endif %}

                        {% if session.user.email_verified is defined %}
                            <li><strong data-tooltip="email_verified">Email verified:</strong> {{ session.user.email_verified }}</li>
                        {% endif %}

                        {% if session.user.phone_number %}
                            <li><strong data-tooltip="phone_number">Phone:</strong> <a href="tel:{{ session.user.phone_number }}">{{ session.user.phone_number }}</a></li>
                        {% endif %}

                        {% if session.user.address %}
                            <li>
                                <strong data-tooltip="address">Address:</strong>
                                <ul>
                                    {% if session.user.address.get("formatted") %}
                                        <li>{{ session.user.address["formatted"] }}</li>
                                    {% else %}
                                        {% if session.user.address.get("street_address") %}
                                            <li>{{ session.user.address["street_address"] }}</li>
                                        {% endif %}
                                        {% if session.user.address.get("postal_code") %}
                                            <li>{{ session.user.address["postal_code"] }}</li>
                                        {% endif %}
                                        {% if session.user.address.get("locality") %}
                                            <li>{{ session.user.address["locality"] }}</li>
                                        {% endif %}
                                        {% if session.user.address.get("region") %}
                                            <li>{{ session.user.address["region"] }}</li>
                                        {% endif %}
                                    {% endif %}
                                </ul>
                            </li>
                        {% endif %}

                        {% if session.user.locale %}
                            <li><strong data-tooltip="locale">Locale:</strong> {{ session.user.locale }}</li>
                        {% endif %}

                        {% if session.user.zoneinfo %}
                            <li><strong data-tooltip="zoneinfo">Timezone:</strong> {{ session.user.zoneinfo }}</li>
                        {% endif %}

                        {% if session.user.birthdate %}
                            <li><strong data-tooltip="birthdate">Birthdate:</strong> {{ session.user.birthdate }}</li>
                        {% endif %}

                        {% if session.user.gender %}
                            <li><strong data-tooltip="gender">Gender:</strong> {{ session.user.gender }}</li>
                        {% endif %}

                        {% if session.user.website %}
                            <li><strong data-tooltip="website">Website:</strong> <a href="{{ session.user.website }}" target="_blank">{{ session.user.website }}</a></li>
                        {% endif %}

                        {% if session.user.groups %}
                            <li>
                                <strong data-tooltip="groups">Groups:</strong>
                                {% for group in session.user.groups %}
                                    <kbd>{{ group }}</kbd>{% if not loop.last %}, {% endif %}
                                {% endfor %}
                            </li>
                        {% endif %}
                    </ul>
                </div>

                <div>
                    <h4>Token metadata</h4>

                    <ul>
                        {% if session.user.iss %}
                            <li><strong data-tooltip="iss">Issuer:</strong> <code>{{ session.user.iss }}</code></li>
                        {% endif %}

                        {% if session.user.aud %}
                            <li>
                                <strong data-tooltip="aud">Audience:</strong>
                                {% if session.user.aud is string %}
                                    <code>{{ session.user.aud }}</code>
                                {% else %}
                                    {% for aud_item in session.user.aud %}
                                        <code>{{ aud_item }}</code>{% if not loop.last %}, {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </li>
                        {% endif %}

                        {% if session.user.auth_time %}
                            <li><strong data-tooltip="auth_time">Auth time:</strong> {{ session.user.auth_time|datetimeformat }}</li>
                        {% endif %}

                        {% if session.user.iat %}
                            <li><strong data-tooltip="iat">Issued at:</strong> {{ session.user.iat|datetimeformat }}</li>
                        {% endif %}

                        {% if session.user.exp %}
                            <li><strong data-tooltip="exp">Expires at:</strong> {{ session.user.exp|datetimeformat }}</li>
                        {% endif %}

                        {% if session.user.nonce %}
                            <li><strong data-tooltip="nonce">Nonce:</strong> <code>{{ session.user.nonce }}</code></li>
                        {% endif %}

                        {% if session.user.at_hash %}
                            <li><strong data-tooltip="at_hash">Access token hash:</strong> <code>{{ session.user.at_hash }}</code></li>
                        {% endif %}

                        {% if session.user.c_hash %}
                            <li><strong data-tooltip="c_hash">Code hash:</strong> <code>{{ session.user.c_hash }}</code></li>
                        {% endif %}

                        {% if session.user.acr %}
                            <li><strong data-tooltip="acr">Auth context class:</strong> <code>{{ session.user.acr }}</code></li>
                        {% endif %}

                        {% if session.user.amr %}
                            <li>
                                <strong data-tooltip="amr">Auth methods:</strong>
                                {% for method in session.user.amr %}
                                    <code>{{ method }}</code>{% if not loop.last %}, {% endif %}
                                {% endfor %}
                            </li>
                        {% endif %}

                        {% if session.user.azp %}
                            <li><strong data-tooltip="azp">Authorized party:</strong> <code>{{ session.user.azp }}</code></li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </article>
    {% endif %}

    <div class="grid">
        {% if session.token.access_token %}
            <article>
                <h3>Access token</h3>
                <p><small>Used to access protected resources on behalf of the user.</small></p>
                <div role="group">
                    <input type="text" value="{{ session.token.access_token }}" readonly aria-label="Access Token">
                    <button type="button" class="copy-token-btn secondary">Copy</button>
                </div>
                <ul>
                    {% if session.token.token_type %}
                        <li><strong>Token type:</strong> {{ session.token.token_type }}</li>
                    {% endif %}
                    {% if session.token.expires_in %}
                        <li><strong>Expires in:</strong> {{ session.token.expires_in }} seconds</li>
                    {% endif %}
                    {% if session.token.expires_at %}
                        <li><strong>Expires at:</strong> {{ session.token.expires_at|datetimeformat }}</li>
                    {% endif %}
                    {% if session.token.scope %}
                        <li><strong>Scope:</strong> {{ session.token.scope }}</li>
                    {% endif %}
                </ul>
            </article>
        {% endif %}

        {% if session.token.refresh_token %}
            <article>
                <h3>Refresh token</h3>
                <p><small>Used to obtain new access tokens without re-authentication.</small></p>
                <div role="group">
                    <input type="text" value="{{ session.token.refresh_token }}" readonly aria-label="Refresh Token">
                    <button type="button" class="copy-token-btn secondary">Copy</button>
                </div>
            </article>
        {% endif %}
    </div>
</section>
